<!--Lista de comunidades-->
<section class="community-container">
    <!--Menú-->
    <div class="col-md-2 col-sm-12 mt-3 fixed-sidebar">
      <!--Barra de búsqueda-->
      <div class="search-bar">
        <input type="text" placeholder="Introduce las primeras letras" />
        <button type="button">
          <i class="fas fa-search"></i>
        </button>
      </div>

      <!--Menú-->
        <div class="short-menu-card">
          <li><a routerLink="/browse/subject">Materias</a></li>
          <li><a routerLink="/browse/author">Autores</a></li>
          <li><a routerLink="/colecciones-une">Colecciones</a></li>
          <li><a routerLink="/community-list">Editoriales</a></li>
        </div>
    </div>

    <cdk-tree [dataSource]="dataSource" [treeControl]="treeControl" [trackBy]="trackBy">
      <!-- Nodo para mostrar las comunidades en el nuevo diseño de tarjeta -->
      <cdk-tree-node *cdkTreeNodeDef="let node; when: !(hasChild && isShowMore)" cdkTreeNodePadding
                     class="example-tree-node childless-node">
        <div [routerLink]="['/communities', node.payload.id]" class="card d-flex flex-row card-community-container" style="width: 100%;">
          <!-- Community logo -->
           <!--Debe mostrar la imagen de los editoriales-->
          <img class="card-img-left" 
              [src]="node.payload.imageUrl || 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjLRAt1FYPP3s5KB3wo4JfJ4WoKU2cPXzvbwd1bGwBPkg65ynXakFdJNv9YWF4IsyaNnb3aWooaTxDrJqSEKA8B8y-An1IiV33_Xf3t-7qnMoNudK9poadh6L27uOQ1L3XYDJ21Wc42eBo/s1600/editorial.jpg'" 
              alt="Logo de {{ dsoNameService.getName(node.payload) }}"
              style="width: 50%; object-fit: cover; border-radius: 11px;"
            >
          <!-- Contenedor del cuerpo de la tarjeta con el nombre de la comunidad -->
          <div class="card-body">
            <h5 class="card-text">{{ dsoNameService.getName(node.payload) }}</h5> <!-- Nombre de la comunidad -->
          </div>
        </div>
      </cdk-tree-node>
    </cdk-tree>
</section>

<!--Datos provisionales-->
<ds-loading *ngIf="(dataSource.loading$ | async) && !loadingNode" class="ds-themed-loading"></ds-loading>
<cdk-tree [dataSource]="dataSource" [treeControl]="treeControl" [trackBy]="trackBy">
  <cdk-tree-node *cdkTreeNodeDef="let node; when: isShowMore" cdkTreeNodePadding
  class="example-tree-node show-more-node">
<div class="btn-group">
<span aria-hidden="true" class="btn btn-default invisible" cdkTreeNodeToggle>
<span class="fa fa-chevron-right"></span>
</span>
<div class="align-middle my-auto">
<button *ngIf="(dataSource.loading$ | async) !== true" (click)="getNextPage(node)"
class="btn btn-outline-primary btn-sm" role="button">
<i class="fas fa-angle-down"></i> {{ 'communityList.showMore' | translate }}
</button>
<ds-loading *ngIf="node===loadingNode && dataSource.loading$ | async" class="ds-themed-loading"></ds-loading>
</div>
</div>
<div class="text-muted" cdkTreeNodePadding>
<div class="d-flex">
</div>
</div>
</cdk-tree-node>
<cdk-tree-node *cdkTreeNodeDef="let node; when: hasChild" cdkTreeNodePadding
  class="example-tree-node expandable-node">
<div class="btn-group">
<button *ngIf="hasChild(null, node) | async" type="button" class="btn btn-default" cdkTreeNodeToggle
[attr.aria-label]="(node.isExpanded ? 'communityList.collapse' : 'communityList.expand') | translate:{ name: dsoNameService.getName(node.payload) }"
(click)="toggleExpanded(node)"
data-test="expand-button">
<span class="{{node.isExpanded ? 'fa fa-chevron-down' : 'fa fa-chevron-right'}}"
aria-hidden="true"></span>
<span class="sr-only">{{ (node.isExpanded ? 'communityList.collapse' : 'communityList.expand') | translate:{ name: dsoNameService.getName(node.payload) } }}</span>
</button>
<span *ngIf="(hasChild(null, node) | async) !== true" aria-hidden="true" class="btn btn-default invisible">
<span class="fa fa-chevron-right"></span>
</span>
<div class="d-flex flex-row">
<span class="d-flex align-middle my-auto">
<a [routerLink]="node.route" class="lead">{{ dsoNameService.getName(node.payload) }}</a>
<span class="pr-2">&nbsp;</span>
<span *ngIf="node.payload.archivedItemsCount >= 0" class="badge badge-pill badge-secondary align-top archived-items-lead my-auto">{{node.payload.archivedItemsCount}}</span>
</span>
</div>
</div>
<ds-truncatable [id]="node.id">
<div class="text-muted" cdkTreeNodePadding>
<div class="d-flex" *ngIf="node.payload.shortDescription">
<span aria-hidden="true" class="btn btn-default invisible">
<span class="fa fa-chevron-right"></span>
</span>
<ds-truncatable-part [id]="node.id" [minLines]="3">
<span>{{node.payload.shortDescription}}</span>
</ds-truncatable-part>
</div>
</div>
</ds-truncatable>
<div class="d-flex" *ngIf="node===loadingNode && dataSource.loading$ | async"
cdkTreeNodePadding>
<span aria-hidden="true" class="btn btn-default invisible">
<span class="fa fa-chevron-right"></span>
</span>
<ds-loading class="ds-themed-loading"></ds-loading>
</div>
</cdk-tree-node>
<cdk-tree-node *cdkTreeNodeDef="let node; when: !(hasChild && isShowMore)" cdkTreeNodePadding
  class="example-tree-node childless-node">
<div class="btn-group">
<span aria-hidden="true" class="btn btn-default invisible" cdkTreeNodeToggle>
<span class="fa fa-chevron-right"></span>
</span>
<h6 class="align-middle my-auto">
<a [routerLink]="node.route" class="lead">{{ dsoNameService.getName(node.payload) }}</a>
</h6>
</div>
<ds-truncatable [id]="node.id">
<div class="text-muted" cdkTreeNodePadding>
<div class="d-flex" *ngIf="node.payload.shortDescription">
<span aria-hidden="true" class="btn btn-default invisible">
<span class="fa fa-chevron-right"></span>
</span>
<ds-truncatable-part [id]="node.id" [minLines]="3">
<span>{{node.payload.shortDescription}}</span>
</ds-truncatable-part>
</div>
</div>
</ds-truncatable>
</cdk-tree-node>
</cdk-tree>